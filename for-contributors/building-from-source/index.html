<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Building From Source - Cardano SL</title>

  <link href="../../css/app.css" rel="stylesheet" media="screen">
  <link href="../../css/app-theme.1.css" rel="stylesheet" media="screen">
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" media="all" />
  
  <script>
    var mkdocs_page_name = "Building From Source";
    var mkdocs_page_input_path = "for-contributors/building-from-source.md";
    var mkdocs_page_url = "/for-contributors/building-from-source/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 

</head>

<body>


  <nav class="navbar navbar-default  navbar-inverse">
    <div class="container">

      <div class="navbar-header cardano logo">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#cardano-nav" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/"><img src="http://static.iohk.io/cardano/images/cardano-white-120.png" alt="" width="40" height="36" /> <span>Cardano SL</span></a>
      </div>

      <div class="collapse navbar-collapse">
        

                <form id ="rtd-search-form" class="navbar-form navbar-right" action="../../search.html" method="get">
                  <div class="form-group">
                    <input type="text" name="q" class="form-control" placeholder="Search docs ... ">
                  </div>
                  <button type="submit" class="btn btn-default"><em class="fa fa-search"></em></button>
                </form>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>

<div class="navbar-grad"></div>


  <div class="container">
      <!-- left, vertical navbar & content -->
      <div class="row">
          <!-- left, vertical navbar -->
          <div class="col-md-3 col-sm-4 col-left">
            	<ul class="nav navbar-collapse collapse navbar-side" id="cardano-nav">
                
                  <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Introduction</a>
        
    </li>
<li>
                
                  <li>
    <li class="toctree-l1 ">
        <a class="" href="../../installation/">Installation</a>
        
    </li>
<li>
                
                  <li>
    <ul class="subnav">
    <li><span>Getting Started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/ui/">Navigating in the User Interface</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/first-transaction/">Your first transaction</a>
        
    </li>

        
    </ul>
<li>
                
                  <li>
    <ul class="subnav">
    <li><span>Cardano Timeline</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../timeline/testnet/">Testnet Era</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../timeline/bootstrap/">Boostrap Era</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../timeline/reward/">Reward Era</a>
        
    </li>

        
    </ul>
<li>
                
                  <li>
    <ul class="subnav">
    <li><span>Cardano building blocks</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cardano/addresses/">Addresses</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cardano/transactions/">Transactions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cardano/proof-of-stake/">Ouroboros Consensus Algorithm</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Scripting</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cardano/plutus/introduction/">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cardano/plutus/types/">Types</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cardano/plutus/examples/">Examples</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
                
                  <li>
    <ul class="subnav">
    <li><span>Contributor's Guide</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Building From Source</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#building-cardano-sl-and-daedalus-from-source">Building Cardano SL and Daedalus from Source</a></li>
                
                    <li><a class="toctree-l4" href="#cardano-sl-and-daedalus-bridge">Cardano SL and Daedalus Bridge</a></li>
                
                    <li><a class="toctree-l4" href="#building-daedalus">Building Daedalus</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
                
                  <li>
    <li class="toctree-l1 ">
        <a class="" href="../../glossary/">Glossary</a>
        
    </li>
<li>
                
              </ul>

          </div>

          <!-- content -->
          <div class="col-md-9 col-sm-8">

              
<ol class="breadcrumb">
  <li><a href="../..">Docs</a></li>
  
    
      
        <li>Contributor's Guide</li>
      
    
  
  <li>Building From Source</li>
  <li class="">
    
  </li>
</ol>
              <div class="main" role="main">
                  
                    <h1 id="building-cardano-sl-and-daedalus-from-source">Building Cardano SL and Daedalus from Source<a class="headerlink" href="#building-cardano-sl-and-daedalus-from-source" title="Permanent link">&para;</a></h1>
<p>Cardano SL consists of a collection of binaries that constitutes
backend, a PureScript API for the Electron-based wallet and the
Electron-based wallet called “Daedalus”. You can read more about design
and architecture of Cardano SL in the <a href="/for-contributors/implementation.md">Implementation
Guide</a>.</p>
<h2 id="cardano-sl-and-daedalus-bridge">Cardano SL and Daedalus Bridge<a class="headerlink" href="#cardano-sl-and-daedalus-bridge" title="Permanent link">&para;</a></h2>
<p>Source code for both Cardano SL and Daedalus Bridge can be obtained
(here)[https://github.com/input-output-hk/pos-haskell-prototype]</p>
<p>We strongly suggest using <a href="https://nixos.org/nix/download.html">Nix package
manager</a> to get the right
dependencies for building Cardano SL. It will fetch the correct
<code>openssl</code> version, but won't override the system-installed version. Same
goes for dependencies such as <code>rocksdb</code>, with which many developers
report having problems. The rest of documentation assumes that the reader
has Nix package manager installed on their machine.</p>
<p>To build the project, first clone the source base and navigate to the root
directory of it:</p>
<pre><code>git clone https://github.com/input-output-hk/pos-haskell-prototype.git
cd pos-haskell-prototype
</code></pre>

<p>Then enter <code>nix-shell</code> and, if it's the first project in Haskell
language on the machine, run <code>stack setup</code>.</p>
<pre><code>Tue Jan 10 sweater@chill ~/github/pos-haskell-prototype (master) 
λ nix-shell
[nix-shell:~/github/pos-haskell-prototype]$ stack setup
* snip *
</code></pre>

<p>After the relevant Haskell compiler version is obtained, let's enable
Nix for all <code>stack</code> builds. To do so, make sure that
<code>~/.stack/config.yaml</code> has the following option:</p>
<pre><code>nix:
  enable: true
</code></pre>

<p>Now in order to build Cardano SL with wallet capabilities, run the
following command:</p>
<pre><code>[nix-shell:~/github/pos-haskell-prototype]
$ stack build --flag cardano-sl:with-wallet --flag cardano-sl:with-web
</code></pre>

<p>Here is the <a href="http://asciinema.org/a/47vbdch8srbhf3j5kta7j9bov">asciinema
cast</a> of the project building.</p>
<p>It is suggested having at least 8GB of RAM and some swap space for the build
process. As the project is fairly large and GHC parallelizes builds very
effectively, memory and CPU consumption during the build process is
demanding.</p>
<p>After the project is built, the built binaries can be launched
using the <code>stack exec</code> command. Let's discuss important binaries briefly
before proceeding to next steps.</p>
<h3 id="cardano-node">cardano-node<a class="headerlink" href="#cardano-node" title="Permanent link">&para;</a></h3>
<p>Binary <code>cardano-node</code> is the most important binary of the system. It
launches nodes. In order to attach to a network, Hardened Kadmelia DHT
peer information has to be supplied. Peer discovery will follow if
initial DHT peer is available. The syntax for communicating initial
DHT peer is the following: <code>--peer HOST:PORT/HOST_ID</code>, for example
<code>discover.memorici.de:21989/MHdtsP-oPf7UWly7QuXnLK5RDB8=</code>.</p>
<p>Before providing an example of running the node, the trickiest command
line arguments are noted.</p>
<p>When a testnet is bootstrapped, stake is distributed across several
addresses in the genesis block. The distributions that are supported
are flat distribution and Bitcoin distribution. Spending and VSS keys
are generated for genesis block. If a node has access to a genesis key
mapping, the index of the secret key in this mapping can be provided
using <code>--vss-genesis N</code> and <code>--spending-genesis N</code>, where <code>N</code> is index
in this mapping.</p>
<p>Example of a local invoaction connecting to HostID
<code>MHdtsP-oPf7UWly007QuXnLK5RD=</code>:</p>
<pre><code>stack exec -- cardano-node \
  --port 3002 \
  --db-path run/node-db2 \
  --vss-genesis 2 --spending-genesis 2 \
  --peer 127.0.0.1:3000/MHdtsP-oPf7UWly007QuXnLK5RD= \
  --json-log=logs/2017-01-10_035413/node2.json \
  --logs-prefix logs/2017-01-10_035413 \
  --log-config logs/2017-01-10_035413/conf/node2.log.yaml \
  --flat-distr &quot;(3, 100000)&quot;
</code></pre>

<h3 id="cardano-smart-generator">cardano-smart-generator<a class="headerlink" href="#cardano-smart-generator" title="Permanent link">&para;</a></h3>
<p>A tool which tests if transactions are accordingly sent by a node in
a network; a stress-test can be invocated by <code>cardano-smart-generator</code>.
This tool is designed to provide reasonable and reliable measurements of
transactions per second (or TPS).</p>
<p>It works in few rounds, each split in few phases.</p>
<p>At start, the initial transaction is submited. This transaction uses unspent
output from the genesis address, index of which is supplied as <code>--index</code>
argument and creates <code>(k + P) * slotDuration * maxTPS</code> outputs, which
would be used for further transactions. <code>k</code> (block depth to treat
transaction as stable) and <code>P</code> (approximate amount of slots needed for a
transaction to be successfully published in a block) are parameters
here. During our benchmarks we were using <code>k=6</code> and <code>P=2</code> with hundred
nodes.</p>
<p>Each round of <code>cardano-smart-generator</code> tests that the system is capable of
handling a concrete TPS value. It goes from value provided by <code>--tps</code>
CLI argument and adjusts it every step by <code>--tps-step</code> value. Both can
be fractional (double precision floats). The process will continue for
at most <code>--round-number</code> (<code>N</code>) rounds.</p>
<p>This way, <code>maxTps = initTps + tpsStep * N</code>.</p>
<p>All further transactions are <code>(in, 1, A)</code>, where </p>
<ul>
<li><code>A</code> is the owner of <code>in</code>;</li>
<li>1 is the amount of coins transferred;</li>
<li><code>in</code> is the output of previous transaction;  </li>
</ul>
<p>Each subsequent transaction is being sent only if the parent is included
into block of depth <code>k</code> (i.e stable). This way there's no possibility
of producing more transactions than a node can include into blocks.</p>
<p>Each round is split to <code>(R + 2)</code> phases. On each phase transactions are
sent with current TPS rate. On the first phase no measurements are taken.gq
On the last phase no new transactions get emmitted, only confirmations
for sent ones being collected.</p>
<p>Each phase takes <code>(k + P) * slotDuration</code> seconds, where <code>P</code> is
approximate amount of slots needed for a successful transaction to be
published in block.</p>
<p>Transactions are sent in a few threads. Each thread uses its own
transaction pool derived from its own index in genesis block.</p>
<p>Here is an example of invocation of <code>cardano-smart-generator</code> sending
transactions from node number zero:</p>
<pre><code>stack exec -- cardano-smart-generator \
  --json-log=txgen.json \
  --index 0 \
  --round-period-rate 60 \
  --round-number 10 \
  --tps 50 \
  --propagate-threshold 4 \
  --tps-sleep 20 \
  --init-money 100000 \
  --peer 127.0.0.1:3000/MHdtsP-oPf7UWly007QuXnLK5RD=
</code></pre>

<p>The purpose of the most important binaries and basic
operations with said binaries is clarified, let's proceed with building
the wallet. On the Haskell side of things, just two matters have to be
addressed —</p>
<ol>
<li>Generate types for <code>daedalus-bridge</code></li>
<li>Build Daedalus Bridge</li>
</ol>
<h3 id="generating-types-for-daedalus-bridge">Generating Types for Daedalus Bridge<a class="headerlink" href="#generating-types-for-daedalus-bridge" title="Permanent link">&para;</a></h3>
<p>To generate types, run</p>
<pre><code>stack exec -- cardano-wallet-hs2purs
</code></pre>

<p>A warning message will be printed that is safe to ignore. Once the types
are generated, proceed to the next step.</p>
<h3 id="building-daedalus-bridge">Building Daedalus Bridge<a class="headerlink" href="#building-daedalus-bridge" title="Permanent link">&para;</a></h3>
<p>To build Daedalus Bridge, some JavaScript heavy-lifting must be done.
Currently Nix expressions don't install Node.js and NPM, so
those have to be installed manually. To do that, consult the repositories
of the package manager of according OS or download binaries from <a href="https://nodejs.org/en/download/">the
net</a> you also will need the following
npm packages: <code>bower</code>, <code>pulp</code>, <code>purescript</code>. Those can be installed with</p>
<pre><code>npm install -g bower pulp purescript
</code></pre>

<p>To build Daedalus Bridge with npm installed, run the following commands:</p>
<pre><code>cd daedalus
npm install
</code></pre>

<p>Running <code>npm install</code> will register <code>daedalus-bridge</code> in local npm
package repository. This way, at any time, <code>daedalus-bridge</code>
dependency can be satisfied in any project that depends on it by
manually running <code>npm link daedalus-bridge</code>.</p>
<h2 id="building-daedalus">Building Daedalus<a class="headerlink" href="#building-daedalus" title="Permanent link">&para;</a></h2>
<p>If the instructions of building Cardano SL and the Bridge have been followed,
building Daedalus wallet is as simple as cloning Daedalus' repository:</p>
<pre><code>git clone https://github.com/input-output-hk/daedalus.git
cd daedalus
</code></pre>

<p>Then execute the following command:</p>
<pre><code>npm install
</code></pre>

<p>Now to run the wallet connected to the Cardano SL in dev-mode, call</p>
<pre><code>npm run dev
</code></pre>
                  
              </div>
          </div>
          <!-- end content -->
      </div>

  </div>


  <div id="foot" class="foot noprint">
      <footer>
          <div class="grad"></div>

          <div class="links network text-center">
              <a href="http://daedaluswallet.io/" target="_blank">Daedalus Wallet</a>  |
              <a href="" target="_blank">Cardano SL Statistics</a> |
              <a href="" target="_blank">Cardano SL Explorer</a> |
              <a href="" target="_blank">Cardano ADA Faucet</a> |
              <a href="http://cardano-docs.rtfd.io" target="_blank">Cardano SL Documentation</a>
          </div>

          <hr />

          <div class="container">

            <div class="footer">
              <div class="row">
              <div class="col-sm-5 cardano logo">

                <a href="https://iohk.io/projects/cardano/" target="_blank" class=""><img src="http://static.iohk.io/cardano/images/cardano-white-120.png" alt="" width="40" height="36" /> <span>Cardano </span></a>

                      <p class="uppercase supported_project"><a href="https://iohk.io/projects/cardano/" target="_blank">IOHK supported project</a></p>
              </div>
              <div class="col-sm-7 text-right links">

                  <a href="" target="_blank">About</a> |
                  <a href="" target="_blank">Github</a> |
                  <a href="" target="_blank">Twitter</a> |
                  <a href="" target="_blank">Privacy policy</a> |
                  <a href="" target="_blank">Terms of Service</a>

              </div>
            </div>
          </div>

          <p class="note">Privacy notice: We store your IP address to prevent abuse of our service. Your IP address is 194.187.251.60.</p>

          </div>
      </footer>
  </div>



  <script type="text/javascript" src="../../js/bootstrap.min.js"></script>
<script>

$(".navbar-side li").each(function(){
  var txt = $(this).text().trim();
  if(txt.length == 0){
    $(this).remove();
  }
});

</script>



  </body>
</html>
